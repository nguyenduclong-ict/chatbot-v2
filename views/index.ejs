<html>
  <head>
    <title>Login facebook</title>
    <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css" />
    <!-- inside stylis -->
    <style>
      html,
      body {
        height: 100vh;
        margin: 0px;
        padding: 0px;
      }
      .container {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .container > * {
        margin-top: 5px;
      }

      .container .form {
        width: 500px;
      }

      #output {
        width: 500px;
        min-height: 100px;
        border-radius: 4px;
        border: solid 1px #ccc;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form">
        <pre id="output"></pre>

        <fb:login-button
          scope="public_profile,email"
          onlogin="checkLoginState();"
        >
        </fb:login-button>

        <button class="btn btn-primary" onclick="handleLoginFacebook()">
          Đăng nhập facebook
        </button>
      </div>
    </div>

    <script>
      const APP_ID = '412923979642743';
      const APP_VERSION = 'v5.0';
      window.fbAsyncInit = function() {
        FB.init({
          appId: APP_ID,
          cookie: true,
          xfbml: true,
          version: APP_VERSION
        });

        FB.AppEvents.logPageView();
      };

      (function(d, s, id) {
        var js,
          fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
          return;
        }
        js = d.createElement(s);
        js.id = id;
        js.src = 'https://connect.facebook.net/en_US/sdk.js';
        fjs.parentNode.insertBefore(js, fjs);
      })(document, 'script', 'facebook-jssdk');

      window.onload = function() {
        FB.getLoginStatus(function(response) {
          statusChangeCallback(response);
        });
      };

      function statusChangeCallback(response) {
        console.log(response);
      }

      function checkLoginState() {
        FB.getLoginStatus(function(response) {
          statusChangeCallback(response);
        });
      }

      function handleLoginFacebook() {
        FB.login(
          loginResponse => {
            this.getUserInfo(loginResponse.authResponse.userID);
          },
          {
            scope:
              'public_profile,email,manage_pages,pages_messaging,pages_messaging_phone_number',
            redirect_uri: 'https://dec796f6.ngrok.io/auth/facebook-login'
          }
        );
      }

      function getUserInfo(userId) {
        console.log('UserId' + userId);
        FB.api('/' + userId + '?fields=name,accounts,email', result => {
          console.log(result);
        });
      }
    </script>
  </body>
</html>
